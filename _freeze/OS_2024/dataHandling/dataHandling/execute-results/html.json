{
  "hash": "a324d054aaf4fe9deba2c43e5d649e6f",
  "result": {
    "markdown": "---\ntitle: \"Data handling and curation - from raw to clean data\"\nformat: \n  revealjs:\n    embed-resources: true\n    logo: \"images/Leaf_LN.png\"\n    slide-number: true\n    show-slide-number: all\nexecute:\n  echo: true\neditor: visual\n---\n\n\n![](images/Ecology_data.jfif)\n\n## ![](images/data%20lifecycle.png)\n\n\n::: {.cell}\n\n:::\n\n\n## Data handling & curation\n\nManaging the \"data life-cycle\" within and beyond a project.\n\n-   creating data\n-   organising data\n-   maintaining data\n\n## Data cleaning vs Data wrangling\n\n***Data cleaning*** is the process of removing incorrect, duplicate, or otherwise erroneous data from a dataset\n\n***Data wrangling*** changing the format to make it more useful for your analysis\n\n## Some R Functions that help data cleaning\n\n### {janitor}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \nlibrary(palmerpenguins) \nlibrary(janitor)  \npalmerpenguins::penguins_raw |>  names() \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"studyName\"           \"Sample Number\"       \"Species\"            \n [4] \"Region\"              \"Island\"              \"Stage\"              \n [7] \"Individual ID\"       \"Clutch Completion\"   \"Date Egg\"           \n[10] \"Culmen Length (mm)\"  \"Culmen Depth (mm)\"   \"Flipper Length (mm)\"\n[13] \"Body Mass (g)\"       \"Sex\"                 \"Delta 15 N (o/oo)\"  \n[16] \"Delta 13 C (o/oo)\"   \"Comments\"           \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\njanitor::clean_names(palmerpenguins::penguins_raw) |>  names()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"study_name\"        \"sample_number\"     \"species\"          \n [4] \"region\"            \"island\"            \"stage\"            \n [7] \"individual_id\"     \"clutch_completion\" \"date_egg\"         \n[10] \"culmen_length_mm\"  \"culmen_depth_mm\"   \"flipper_length_mm\"\n[13] \"body_mass_g\"       \"sex\"               \"delta_15_n_o_oo\"  \n[16] \"delta_13_c_o_oo\"   \"comments\"         \n```\n:::\n:::\n\n\n## \n\n### {dplyr}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclean_penguins<-janitor::clean_names(palmerpenguins::penguins_raw)  \n\ndplyr::glimpse(clean_penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 17\n$ study_name        <chr> \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708â€¦\n$ sample_number     <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1â€¦\n$ species           <chr> \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Penguâ€¦\n$ region            <chr> \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Aâ€¦\n$ island            <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", â€¦\n$ stage             <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, â€¦\n$ individual_id     <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", \"N4Aâ€¦\n$ clutch_completion <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", \"No\"â€¦\n$ date_egg          <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16, 200â€¦\n$ culmen_length_mm  <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, â€¦\n$ culmen_depth_mm   <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, â€¦\n$ flipper_length_mm <dbl> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186â€¦\n$ body_mass_g       <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, â€¦\n$ sex               <chr> \"MALE\", \"FEMALE\", \"FEMALE\", NA, \"FEMALE\", \"MALE\", \"Fâ€¦\n$ delta_15_n_o_oo   <dbl> NA, 8.94956, 8.36821, NA, 8.76651, 8.66496, 9.18718,â€¦\n$ delta_13_c_o_oo   <dbl> NA, -24.69454, -25.33302, NA, -25.32426, -25.29805, â€¦\n$ comments          <chr> \"Not enough blood for isotopes.\", NA, NA, \"Adult notâ€¦\n```\n:::\n:::\n\n\n## \n\n### {skimr}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nout<-skimr::skim(palmerpenguins::penguins_raw) \n\nout\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |                             |\n|:------------------------|:----------------------------|\n|Name                     |palmerpenguins::penguins_... |\n|Number of rows           |344                          |\n|Number of columns        |17                           |\n|_______________________  |                             |\n|Column type frequency:   |                             |\n|character                |9                            |\n|Date                     |1                            |\n|numeric                  |7                            |\n|________________________ |                             |\n|Group variables          |None                         |\n\n\n**Variable type: character**\n\n|skim_variable     | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-----------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|studyName         |         0|          1.00|   7|   7|     0|        3|          0|\n|Species           |         0|          1.00|  33|  41|     0|        3|          0|\n|Region            |         0|          1.00|   6|   6|     0|        1|          0|\n|Island            |         0|          1.00|   5|   9|     0|        3|          0|\n|Stage             |         0|          1.00|  18|  18|     0|        1|          0|\n|Individual ID     |         0|          1.00|   4|   6|     0|      190|          0|\n|Clutch Completion |         0|          1.00|   2|   3|     0|        2|          0|\n|Sex               |        11|          0.97|   4|   6|     0|        2|          0|\n|Comments          |       290|          0.16|  18|  68|     0|       10|          0|\n\n\n**Variable type: Date**\n\n|skim_variable | n_missing| complete_rate|min        |max        |median     | n_unique|\n|:-------------|---------:|-------------:|:----------|:----------|:----------|--------:|\n|Date Egg      |         0|             1|2007-11-09 |2009-12-01 |2008-11-09 |       50|\n\n\n**Variable type: numeric**\n\n|skim_variable       | n_missing| complete_rate|    mean|     sd|      p0|     p25|     p50|     p75|    p100|hist  |\n|:-------------------|---------:|-------------:|-------:|------:|-------:|-------:|-------:|-------:|-------:|:-----|\n|Sample Number       |         0|          1.00|   63.15|  40.43|    1.00|   29.00|   58.00|   95.25|  152.00|â–‡â–‡â–†â–…â–ƒ |\n|Culmen Length (mm)  |         2|          0.99|   43.92|   5.46|   32.10|   39.23|   44.45|   48.50|   59.60|â–ƒâ–‡â–‡â–†â– |\n|Culmen Depth (mm)   |         2|          0.99|   17.15|   1.97|   13.10|   15.60|   17.30|   18.70|   21.50|â–…â–…â–‡â–‡â–‚ |\n|Flipper Length (mm) |         2|          0.99|  200.92|  14.06|  172.00|  190.00|  197.00|  213.00|  231.00|â–‚â–‡â–ƒâ–…â–‚ |\n|Body Mass (g)       |         2|          0.99| 4201.75| 801.95| 2700.00| 3550.00| 4050.00| 4750.00| 6300.00|â–ƒâ–‡â–†â–ƒâ–‚ |\n|Delta 15 N (o/oo)   |        14|          0.96|    8.73|   0.55|    7.63|    8.30|    8.65|    9.17|   10.03|â–ƒâ–‡â–†â–…â–‚ |\n|Delta 13 C (o/oo)   |        13|          0.96|  -25.69|   0.79|  -27.02|  -26.32|  -25.83|  -25.06|  -23.79|â–†â–‡â–…â–…â–‚ |\n:::\n:::\n\n\n## \n\n### {dplyr}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Deduplication  \ndata<-tibble(Day=c(\"Monday\", \"Tuesday\",\"Wednesday\", \"Wednesday\"), \n             Person=c(\"Becks\", \"Amy\", \"Matt\", \"Matt\"))\ndata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 Ã— 2\n  Day       Person\n  <chr>     <chr> \n1 Monday    Becks \n2 Tuesday   Amy   \n3 Wednesday Matt  \n4 Wednesday Matt  \n```\n:::\n\n```{.r .cell-code}\ndata |> dplyr::distinct()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 Ã— 2\n  Day       Person\n  <chr>     <chr> \n1 Monday    Becks \n2 Tuesday   Amy   \n3 Wednesday Matt  \n```\n:::\n:::\n\n\n## \n\n### {naniar}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creating some data with missing values\nmissing_penguins<-missMethods::delete_MCAR(clean_penguins, 0.3) \n\n\nmissing_penguins |> \nnaniar::vis_miss()\n```\n\n::: {.cell-output-display}\n![](dataHandling_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n## Missing data\n\nMissing data is normally a problem. Typically as ecologists we sweep missing data under the carpet by using a \"complete case\" approach to data analysis.\n\n![](images/SWEEP-IT-UNDER-THE-CARPET-BANKSY-2.jpg)\n\n## \n\nIf you have ever written some code like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# na.omit() \ndf <- na.omit(df)  \n# complete.cases() \ndf <- df[complete.cases(df), ]   \n# rowSums() \ndf <- df[rowSums(is.na(df)) == 0, ]   \n# drop_na() \ndf <- df  |>  tidyr::drop_na()\n```\n:::\n\n\nyou are removing missing data (NAs) from your dataset.\n\n## Why is this a problem?\n\nBy throwing away potentially useful data (only including those rows without a NA in them) you reduce the information you are working with, reduce statistical power and introduce selection bias (invalidating any assumption of randomisation).\n\n## Different types of missingness\n\nThere are three broad categories of missing data:\n\n-   MCAR - missingness is not related to any measured or unmeasured variables\n\n-   MAR - missingness is not random but related to other variables and can be accounted for by another complete variable\n\n-   MNAR - missingness is related to the missing data itself (there is a systematic reason why the data are missing within a particular variable)\n\n## \n\nImagine that we are measuring rainfall at weather stations across Norway every year.\n\n::: {#tbl-panel layout-ncol=\"2\"}\n| station number | rainfall |\n|----------------|----------|\n| 1              | 30       |\n| 2              | 150      |\n| 3              | 75       |\n| 4              | 250      |\n| 5              | 55       |\n\n: Complete data {#tbl-complete}\n\n| station number | rainfall |\n|----------------|----------|\n| 1              | 30       |\n| 2              |          |\n| 3              |          |\n| 4              | 250      |\n| 5              | 55       |\n\n: MCAR {#tbl-MCAR}\n\nMissing data patterns - MCAR\n:::\n\n## \n\n::: {layout-ncol=\"2\"}\n| station number | rainfall |\n|----------------|----------|\n| 1              | 30       |\n| 2              | 150      |\n| 3              | 75       |\n| 4              | 250      |\n| 5              | 55       |\n\n: Complete data {#tbl-complete2}\n\n| station number | rainfall |\n|----------------|----------|\n| 1              |          |\n| 2              |          |\n| 3              |          |\n| 4              | 250      |\n| 5              | 55       |\n\n: MAR {#tbl-MAR}\n\nMissing data patterns - MAR\n:::\n\n## \n\n::: {layout-ncol=\"2\"}\n| station number | rainfall |\n|----------------|----------|\n| 1              | 30       |\n| 2              | 150      |\n| 3              | 75       |\n| 4              | 250      |\n| 5              | 55       |\n\n: Complete data {#tbl-complete3}\n\n| station number | rainfall |\n|----------------|----------|\n| 1              | 30       |\n| 2              |          |\n| 3              | 75       |\n| 4              |          |\n| 5              | 55       |\n\n: MNAR {#tbl-MNAR}\n\nMissing data patterns - MNAR\n:::\n\n## What effect does missingness have?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse, quietly = TRUE) \nlibrary(missMethods, quietly = TRUE) \nlibrary(palmerpenguins)\n\n#create datasets with levels missingness\n\npenguins_complete<-penguins |> \n  drop_na()\n\nmiss_penguins_MCAR<-\n  missMethods::delete_MCAR(penguins_complete, \n                                             0.3, \"flipper_length_mm\") \n# create a pattern of missingness with censoring \n#(missing value in flipper_length \n#if body_mass is below 30% quantile of body_mass)\n\nmiss_penguins_MAR<-\n  missMethods::delete_MAR_censoring(penguins_complete,\n                                                     0.3, \"flipper_length_mm\", \"body_mass_g\") \n# create a pattern of missingness with censoring \n#(missing value in flipper_length \n#if flipper_length is below 30% quantile) \n\nmiss_penguins_MNAR<-\n  missMethods::delete_MNAR_censoring(penguins_complete, \n                                                       0.3, \"flipper_length_mm\")\n\nall_data<-bind_rows(\"Full\"=penguins_complete, \n                    \"MCAR\"= miss_penguins_MCAR,\n                    \"MAR\"= miss_penguins_MAR,\n                    \"MNAR\"=miss_penguins_MNAR, \n                    .id=\"Missingness\")\n```\n:::\n\n\n## \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](dataHandling_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n## \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](dataHandling_files/figure-revealjs/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n\n## \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](dataHandling_files/figure-revealjs/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n\n## What can we do about missing data?\n\nWith MCAR and MAR we can use multiple imputation techniques\n\n![](images/MICE.png)\n\n## \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load mice\nlibrary(mice, quietly = TRUE)\n\n# Set seed for reproducibility\nset.seed(123)\n\n# Simulate data: location, year, count\nlocations <- rep(1:5, each = 5)  # Assuming 5 locations\nyears <- rep(2009:2023, 5)  # Assuming data for 5 years\ncount <- round(rpois(25, lambda = 20))  # Simulated count data\n\n# Create a dataframe\ndata <- data.frame(Location = locations, Year = years, Count = count)\n\n# Introduce missingness - Missing completely at random (MCAR)\nprop_missing <- 0.2  # Example: 20% missingness\nmissing_indices <- sample(1:nrow(data), prop_missing * nrow(data))\ndata$Count[missing_indices] <- NA\n\n# Check the structure of the data\nstr(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t75 obs. of  3 variables:\n $ Location: int  1 1 1 1 1 2 2 2 2 2 ...\n $ Year    : int  2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 ...\n $ Count   : num  17 25 12 20 27 NA 14 NA 25 21 ...\n```\n:::\n:::\n\n\n## \n\nWhen we impute the missing data we use 5 replicates and then take the mean of all 5 datasets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Impute missing data using MICE\nimp <- mice(data, m = 5, method = 'pmm', seed = 500)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n iter imp variable\n  1   1  Count\n  1   2  Count\n  1   3  Count\n  1   4  Count\n  1   5  Count\n  2   1  Count\n  2   2  Count\n  2   3  Count\n  2   4  Count\n  2   5  Count\n  3   1  Count\n  3   2  Count\n  3   3  Count\n  3   4  Count\n  3   5  Count\n  4   1  Count\n  4   2  Count\n  4   3  Count\n  4   4  Count\n  4   5  Count\n  5   1  Count\n  5   2  Count\n  5   3  Count\n  5   4  Count\n  5   5  Count\n```\n:::\n:::\n\n\n## \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](dataHandling_files/figure-revealjs/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n\n## sem() instead of lm()\n\nUsing a Structured Equation Model (SEM) we can run a simple linear regression.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lavaan)\n# we will use the Iris dataset for this example\ncomplete_model<-lm(Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length, data=iris)\n\niris_MCAR<-missMethods::delete_MCAR(iris, 0.3, \"Sepal.Width\")\n\nmiss_model1<-lm(Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length, data=iris_MCAR)\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\n=====================================================================\n                                   Dependent variable:               \n                    -------------------------------------------------\n                                       Petal.Width                   \n                              (1)                      (2)           \n---------------------------------------------------------------------\nSepal.Length               -0.207***                 -0.187**        \n                            (0.048)                  (0.057)         \nSepal.Width                 0.223***                 0.219***        \n                            (0.049)                  (0.057)         \nPetal.Length                0.524***                 0.516***        \n                            (0.024)                  (0.029)         \nConstant                     -0.240                   -0.315         \n                            (0.178)                  (0.215)         \n---------------------------------------------------------------------\nObservations                  150                      105           \nR2                           0.938                    0.931          \nAdjusted R2                  0.937                    0.929          \nResidual Std. Error     0.192 (df = 146)         0.204 (df = 101)    \nF Statistic         734.389*** (df = 3; 146) 454.577*** (df = 3; 101)\n=====================================================================\nNote:                                   *p<0.05; **p<0.01; ***p<0.001\n```\n:::\n:::\n\n\n## \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmiss_model2 <- sem('Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length', data=iris_MCAR, missing=\"ML\")\nsummary(miss_model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nlavaan 0.6-19 ended normally after 1 iteration\n\n  Estimator                                         ML\n  Optimization method                           NLMINB\n  Number of model parameters                         5\n\n                                                  Used       Total\n  Number of observations                           105         150\n  Number of missing patterns                         1            \n\nModel Test User Model:\n                                                      \n  Test statistic                                 0.000\n  Degrees of freedom                                 0\n\nParameter Estimates:\n\n  Standard errors                             Standard\n  Information                                 Observed\n  Observed information based on                Hessian\n\nRegressions:\n                   Estimate  Std.Err  z-value  P(>|z|)\n  Petal.Width ~                                       \n    Sepal.Length     -0.187    0.056   -3.344    0.001\n    Sepal.Width       0.219    0.056    3.945    0.000\n    Petal.Length      0.516    0.028   18.133    0.000\n\nIntercepts:\n                   Estimate  Std.Err  z-value  P(>|z|)\n   .Petal.Width      -0.315    0.211   -1.493    0.135\n\nVariances:\n                   Estimate  Std.Err  z-value  P(>|z|)\n   .Petal.Width       0.040    0.006    7.246    0.000\n```\n:::\n:::\n\n\nAdding the argument 'missing = \"ML\"' to the sem() function estimates a likelihood function for each row based on the variables that are present so that all the available data are used.\n\n## Data validation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.validator)  \nreport <- data_validation_report()  \n\nbetween <- function(a, b) {\n  function(x) { a <= x & x <= b }\n}\n\nvalidate(iris, name = \"Verifying flower dataset\") |> \n  validate_if(Sepal.Length > 0, description = \"Sepal length is greater than 0\") |> \n  validate_cols(between(0, 4), Sepal.Width, description = \"Sepal width is between 0 and 4\") |> \n  add_results(report)\n\nprint(report)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nValidation summary: \n Number of successful validations: 1\n Number of validations with warnings: 0\n Number of failed validations: 1\n\nAdvanced view: \n\n\n|table_name               |description                    |type    | total_violations|\n|:------------------------|:------------------------------|:-------|----------------:|\n|Verifying flower dataset |Sepal length is greater than 0 |success |               NA|\n|Verifying flower dataset |Sepal width is between 0 and 4 |error   |                3|\n```\n:::\n:::\n\n\n## \n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(report)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nValidation summary: \n Number of successful validations: 1\n Number of validations with warnings: 0\n Number of failed validations: 1\n\nAdvanced view: \n\n\n|table_name               |description                    |type    | total_violations|\n|:------------------------|:------------------------------|:-------|----------------:|\n|Verifying flower dataset |Sepal length is greater than 0 |success |               NA|\n|Verifying flower dataset |Sepal width is between 0 and 4 |error   |                3|\n```\n:::\n:::\n\n\n## Messy data\n\nLook at the messy data dataset. How would you go about cleaning this dataset?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmessy_data <- readRDS(here::here(\"OS_2024/dataHandling/data/messy_data.RDS\")) \n\nmessy_data |> data.table::data.table() \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           Date    SEX      age    Species Name       lat      lon count\n         <char> <char>   <char>          <char>     <num>    <num> <int>\n  1: 2023/02/01   male    Adult    Lagopus matu  9.123826 62.92628     5\n  2:   02/02/23 Female Juvenile    Logopus muta  7.836517 61.70676     9\n  3: 2023/02/01   male        J    Logopus muta  9.387262 63.84034    15\n  4: 01-01-2023 female    ADULT Lagopus lagopus  9.609423 61.06334    14\n  5: 01-01-2023   Male    ADULT    Lagopus matu  8.531654 63.44823    10\n  6: 2023-02-01   Male        A    Lagopus muta 10.369053 62.60819    10\n  7:   02/02/23 FEMALE JUVENILE    Lagopus muta  9.297162 62.71758    11\n  8:   02-01-23 FEMALE    Adult Lagopus lagopus  6.479778 61.59151    15\n  9: 2023-02-01 female Juvenile    Lagopus muta  7.879991 63.10879     4\n 10:   02/02/23   MALE JUVENILE    Lagopus muta  6.794386 62.41039    14\n 11: 2023/02/01 Female    ADULT    Lagopus matu 10.075820 62.14845     6\n 12:   02-01-23   MALE        J Lagopas lagopus  9.368355 64.29196    13\n 13: 2023/02/01 Female    ADULT    Lagopus matu 10.933222 63.08134     8\n 14: 01-01-2023   Male        A    Logopus muta  9.508031 61.63579     7\n 15:   02/02/23   MALE JUVENILE    Logopus muta 10.925062 62.59583     4\n 16:   02/02/23 female        A Lagopus lagopus  9.279532 62.91511    11\n 17:   02/02/23   male        J Lagopus lagopus  9.139805 65.96236    10\n 18: 2023-02-01   male Juvenile Lagopas lagopus 10.119368 62.39573    15\n 19:   02-01-23   MALE    Adult    Lagopus matu  7.847859 64.10893    10\n 20: 2023-02-01   male JUVENILE    Lagopus muta 10.732284 64.42712    13\n 21: 2023/02/01 Female        A Lagopas lagopus  8.541997 62.14247    14\n 22:   02/02/23   male        J    Logopus muta  9.220419 62.62880    13\n 23:   02-01-23 female JUVENILE Lagopus lagopus  9.624997 63.91689    13\n 24: 01-01-2023 female    Adult Lagopas lagopus  8.769459 62.61416     9\n 25: 01-01-2023 FEMALE    ADULT    Lagopus matu  9.011462 64.40237     2\n 26:   02-01-23   MALE    ADULT Lagopas lagopus  8.343305 63.35766    19\n 27: 2023/02/01   Male JUVENILE Lagopus lagopus  7.015809 62.97256    10\n 28: 2023-02-01   MALE    ADULT Lagopas lagopus  7.249466 63.64190     5\n 29:   02/02/23 FEMALE    Adult Lagopas lagopus  9.762441 61.59733     6\n 30: 2023/02/01 Female Juvenile Lagopas lagopus  9.081167 62.09558     6\n 31: 2023/02/01   MALE JUVENILE    Logopus muta  8.544149 64.01272    15\n 32: 2023/02/01 FEMALE JUVENILE Lagopas lagopus  9.115873 64.69849     9\n 33: 01-01-2023   male    ADULT    Lagopus matu  7.281479 63.76351    12\n 34: 2023/02/01 female JUVENILE    Lagopus muta 10.688551 63.98931    15\n 35:   02-01-23   Male Juvenile Lagopus lagopus  9.927145 62.94457     7\n 36:   02-01-23   male Juvenile    Logopus muta  8.498186 62.40878     9\n 37:   02-01-23 female Juvenile    Lagopus matu  8.993657 64.06921     0\n 38: 2023-02-01 female    ADULT    Logopus muta  8.400518 63.67579     3\n 39: 2023/02/01   Male    ADULT    Lagopus matu  8.671143 63.79903    18\n 40: 01-01-2023 female        J    Lagopus matu  9.794615 61.83442     5\n 41: 2023/02/01   MALE        A    Logopus muta  7.662123 63.20559    18\n 42: 01-01-2023   male        A    Logopus muta  7.971045 64.32591    15\n 43: 01-01-2023 female        J    Lagopus matu  8.777006 62.43949    11\n 44:   02/02/23   Male Juvenile    Lagopus muta  8.228000 62.71882    16\n 45: 01-01-2023 Female        J    Lagopus muta  8.912136 61.42190     5\n 46: 01-01-2023   MALE Juvenile    Lagopus muta 10.286843 62.89537     7\n 47: 2023/02/01   male    Adult    Logopus muta  9.195381 61.35946     6\n 48:   02-01-23 Female        J    Lagopus matu  8.801430 62.92860     2\n 49:   02/02/23 female        J Lagopas lagopus 11.148595 63.51963    10\n 50:   02/02/23 female    ADULT Lagopas lagopus  7.861651 62.37019    12\n 51: 2023-02-01 female        A    Lagopus muta  9.238828 62.88834     5\n 52: 2023/02/01 female JUVENILE    Logopus muta  9.126381 63.92296    13\n 53:   02-01-23 female Juvenile Lagopas lagopus 10.303237 62.86576     5\n 54: 01-01-2023 female        A Lagopas lagopus  8.745229 62.17313    18\n 55:   02-01-23 female        A    Logopus muta  8.691021 62.10421     6\n 56:   02/02/23 female JUVENILE Lagopas lagopus  9.314176 62.15080    15\n 57: 01-01-2023 Female Juvenile    Logopus muta  7.122930 62.32509    11\n 58: 2023-02-01 Female        A Lagopas lagopus  9.117661 61.81606    18\n 59: 01-01-2023   male        A Lagopas lagopus  9.800076 63.52459     3\n 60: 2023/02/01 Female JUVENILE    Lagopus matu  9.263243 63.46659    12\n 61:   02-01-23 Female    Adult Lagopas lagopus  9.432039 61.53335     7\n 62: 2023-02-01   Male    Adult    Lagopus matu  7.910848 62.92433     1\n 63:   02/02/23   Male        J    Logopus muta  9.092678 61.07257    13\n 64: 2023/02/01   male        A Lagopus lagopus 10.627507 62.46044     9\n 65: 2023/02/01   MALE        A    Lagopus matu  8.575023 62.45981    13\n 66: 01-01-2023 female JUVENILE Lagopas lagopus 10.736562 64.37288     5\n 67: 01-01-2023   MALE    ADULT Lagopas lagopus 10.644320 64.10796    14\n 68:   02-01-23   MALE    ADULT Lagopus lagopus  8.442710 65.27996    12\n 69:   02-01-23 FEMALE Juvenile Lagopas lagopus  7.970893 62.21394     6\n 70:   02/02/23   male Juvenile    Lagopus muta  7.002591 62.35749     7\n 71: 01-01-2023 FEMALE    ADULT Lagopus lagopus  9.516319 63.04347     6\n 72: 01-01-2023 Female        A    Lagopus muta  8.313179 64.23023    12\n 73: 2023-02-01 female        A Lagopas lagopus  7.678440 63.40045     6\n 74:   02-01-23   male    ADULT    Lagopus matu  8.729332 60.78910     5\n 75: 01-01-2023 Female    Adult    Logopus muta  9.753151 63.08899     8\n 76:   02/02/23 FEMALE    Adult    Lagopus matu  7.873569 62.33233     8\n 77: 01-01-2023   male Juvenile Lagopas lagopus  8.963270 62.15332     9\n 78:   02/02/23   male    ADULT Lagopus lagopus  8.428166 64.55505     4\n 79:   02/02/23 Female        A Lagopas lagopus  9.471109 61.53559    11\n 80: 01-01-2023   MALE        J    Lagopus matu  9.236367 62.27483    12\n 81: 2023-02-01 female    ADULT    Lagopus muta  8.939548 63.26092     3\n 82:   02-01-23 female    ADULT    Logopus muta  9.227044 61.22400     5\n 83: 2023-02-01 female JUVENILE    Lagopus muta  9.318695 62.20958    11\n 84:   02/02/23 female Juvenile    Lagopus matu  8.708364 63.88290     7\n 85:   02/02/23 female JUVENILE Lagopas lagopus  8.872903 63.71204     8\n 86: 2023/02/01 female    Adult    Lagopus matu  7.703743 63.25247     1\n 87: 2023-02-01 Female        A    Lagopus matu  9.127351 62.30380    11\n 88: 2023-02-01 Female    Adult    Lagopus matu  9.523766 60.64250     8\n 89: 2023/02/01 female        J Lagopas lagopus  9.181112 61.92349    12\n 90:   02/02/23   MALE Juvenile Lagopas lagopus  7.702984 61.91841     4\n 91:   02-01-23 female        J    Logopus muta  8.141424 63.80680     9\n 92:   02-01-23   male Juvenile    Lagopus matu 11.014120 64.89251    18\n 93: 01-01-2023   MALE JUVENILE    Lagopus muta  6.444234 64.92426     7\n 94: 01-01-2023   male        J    Logopus muta  8.507807 63.49817     5\n 95:   02-01-23 Female Juvenile    Lagopus matu  9.379068 62.59566     8\n 96:   02-01-23   Male        J Lagopus lagopus  8.190334 61.91115    13\n 97:   02-01-23   male        A    Lagopus matu  8.489750 63.48030     7\n 98:   02/02/23 FEMALE    Adult    Lagopus muta 10.193635 62.98715    15\n 99:   02/02/23   MALE        J    Logopus muta  8.798305 63.96787     5\n100: 2023-02-01   MALE        A    Lagopus matu  7.846161 63.42758    14\n           Date    SEX      age    Species Name       lat      lon count\n```\n:::\n:::\n\n\n## Data wrangling\n\n![](images/Longwide.png)\n\n## Transform to long format\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \n# this avoids tidyverse conflicts with the base function filter \nconflicted::conflict_prefer(\"filter\", \"dplyr\") \n# Pivot longer  \npenguins_long<-penguins |>\n  pivot_longer(contains(\"_\"),names_to = c(\"part\", \"measure\" , \"unit\"),names_sep = \"_\")  \n\npenguins_long \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,376 Ã— 8\n   species island    sex     year part    measure unit   value\n   <fct>   <fct>     <fct>  <int> <chr>   <chr>   <chr>  <dbl>\n 1 Adelie  Torgersen male    2007 bill    length  mm      39.1\n 2 Adelie  Torgersen male    2007 bill    depth   mm      18.7\n 3 Adelie  Torgersen male    2007 flipper length  mm     181  \n 4 Adelie  Torgersen male    2007 body    mass    g     3750  \n 5 Adelie  Torgersen female  2007 bill    length  mm      39.5\n 6 Adelie  Torgersen female  2007 bill    depth   mm      17.4\n 7 Adelie  Torgersen female  2007 flipper length  mm     186  \n 8 Adelie  Torgersen female  2007 body    mass    g     3800  \n 9 Adelie  Torgersen female  2007 bill    length  mm      40.3\n10 Adelie  Torgersen female  2007 bill    depth   mm      18  \n# â„¹ 1,366 more rows\n```\n:::\n:::\n\n\n## Transform to wide format\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_long |>\n  pivot_wider(names_from = species, values_from = value) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 92 Ã— 9\n   island    sex     year part    measure unit  Adelie    Gentoo Chinstrap\n   <fct>     <fct>  <int> <chr>   <chr>   <chr> <list>    <list> <list>   \n 1 Torgersen male    2007 bill    length  mm    <dbl [7]> <NULL> <NULL>   \n 2 Torgersen male    2007 bill    depth   mm    <dbl [7]> <NULL> <NULL>   \n 3 Torgersen male    2007 flipper length  mm    <dbl [7]> <NULL> <NULL>   \n 4 Torgersen male    2007 body    mass    g     <dbl [7]> <NULL> <NULL>   \n 5 Torgersen female  2007 bill    length  mm    <dbl [8]> <NULL> <NULL>   \n 6 Torgersen female  2007 bill    depth   mm    <dbl [8]> <NULL> <NULL>   \n 7 Torgersen female  2007 flipper length  mm    <dbl [8]> <NULL> <NULL>   \n 8 Torgersen female  2007 body    mass    g     <dbl [8]> <NULL> <NULL>   \n 9 Torgersen <NA>    2007 bill    length  mm    <dbl [5]> <NULL> <NULL>   \n10 Torgersen <NA>    2007 bill    depth   mm    <dbl [5]> <NULL> <NULL>   \n# â„¹ 82 more rows\n```\n:::\n:::\n\n\n## What's going on?\n\nNo identifier for each observation so R puts all the values in a list. To solve this we need a unique row id.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_long |>\n  mutate(sample=row_number()) |>\n  pivot_wider(names_from = species,values_from = value) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,376 Ã— 10\n   island    sex     year part    measure unit  sample Adelie Gentoo Chinstrap\n   <fct>     <fct>  <int> <chr>   <chr>   <chr>  <int>  <dbl>  <dbl>     <dbl>\n 1 Torgersen male    2007 bill    length  mm         1   39.1     NA        NA\n 2 Torgersen male    2007 bill    depth   mm         2   18.7     NA        NA\n 3 Torgersen male    2007 flipper length  mm         3  181       NA        NA\n 4 Torgersen male    2007 body    mass    g          4 3750       NA        NA\n 5 Torgersen female  2007 bill    length  mm         5   39.5     NA        NA\n 6 Torgersen female  2007 bill    depth   mm         6   17.4     NA        NA\n 7 Torgersen female  2007 flipper length  mm         7  186       NA        NA\n 8 Torgersen female  2007 body    mass    g          8 3800       NA        NA\n 9 Torgersen female  2007 bill    length  mm         9   40.3     NA        NA\n10 Torgersen female  2007 bill    depth   mm        10   18       NA        NA\n# â„¹ 1,366 more rows\n```\n:::\n:::\n\n\n## Tidy data\n\n![](images/data-science.png)\n\n## Tidy data principles\n\n![](images/tidy-1.png)\n\n## Untidy data\n\nHave a look at the smallGame dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmallGame <- readRDS(here::here(\"OS_2024/dataHandling/data/smallGame.RDS\"))\n```\n:::\n\n\n-   What format is it in (long or wide)?\n\n-   How would you convert it to the other format?\n\n-   Which format do you find easier to use? (there is no \"correct\" answer to this one!)\n\n## Code style\n\nWhat are attributes of good code?\n\nHave a look at the \"notReproducible.qmd\" file\n\n## Tidyverse style guide\n\n[\"Good coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread.\"](https://style.tidyverse.org/)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Examples \nday_one # Good \nDayOne # Bad \n# Avoid names of common functions\nT <- FALSE # Bad \nc <- 10 # Bad \nmean <- function(x) sum(x) # Bad \n# Space after a comma \nx[, 1] # Good \nx[,1] # Bad \n# space after () in functions \nfunction(x) {}# Good \nfunction (x) {} # Bad \nfunction(x){} # Bad \n```\n:::\n\n\n## Useful packages for style\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lintr)\n# Define the code as a character vector\ncode <- c(\n  \"# Spacing \",\n  \"average<-mean(feet/12 + inches,na.rm=TRUE)\",\n  \"sqrt(x ^ 2 + y ^ 2)\",\n  \"x <- 1 : 10\",\n  \"base :: get\",\n  \"# Indenting\",\n  \"if (y < 0 && debug)\",\n  \"  message('Y is negative')\",\n  \"# Assignment\",\n  \"x = 5\"\n)\n\n# Write the code to 'bad_style.R'\nwriteLines(code, \"bad_style.R\")\n\n# Run lintr on the newly created file\nlint(\"bad_style.R\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n/Users/audhalbritter/Dropbox/Bergen/OS_course/OS-course-teaching-material/OS_2024/dataHandling/bad_style.R:1:10: style: [trailing_whitespace_linter] Trailing whitespace is superfluous.\n# Spacing \n         ^\n/Users/audhalbritter/Dropbox/Bergen/OS_course/OS-course-teaching-material/OS_2024/dataHandling/bad_style.R:2:8: style: [infix_spaces_linter] Put spaces around all infix operators.\naverage<-mean(feet/12 + inches,na.rm=TRUE)\n       ^~\n/Users/audhalbritter/Dropbox/Bergen/OS_course/OS-course-teaching-material/OS_2024/dataHandling/bad_style.R:2:19: style: [infix_spaces_linter] Put spaces around all infix operators.\naverage<-mean(feet/12 + inches,na.rm=TRUE)\n                  ^\n/Users/audhalbritter/Dropbox/Bergen/OS_course/OS-course-teaching-material/OS_2024/dataHandling/bad_style.R:2:32: style: [commas_linter] Commas should always have a space after.\naverage<-mean(feet/12 + inches,na.rm=TRUE)\n                               ^\n/Users/audhalbritter/Dropbox/Bergen/OS_course/OS-course-teaching-material/OS_2024/dataHandling/bad_style.R:2:37: style: [infix_spaces_linter] Put spaces around all infix operators.\naverage<-mean(feet/12 + inches,na.rm=TRUE)\n                                    ^\n/Users/audhalbritter/Dropbox/Bergen/OS_course/OS-course-teaching-material/OS_2024/dataHandling/bad_style.R:8:11: style: [quotes_linter] Only use double-quotes.\n  message('Y is negative')\n          ^~~~~~~~~~~~~~~\n/Users/audhalbritter/Dropbox/Bergen/OS_course/OS-course-teaching-material/OS_2024/dataHandling/bad_style.R:10:3: style: [assignment_linter] Use <-, not =, for assignment.\nx = 5\n  ^\n```\n:::\n:::\n\n\n## \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"styler\") \nstyle_file(\"bad_style.R\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nStyling  1  files:\n bad_style.R â„¹ \nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nStatus\tCount\tLegend \nâœ” \t0\tFile unchanged.\nâ„¹ \t1\tFile changed.\nâœ– \t0\tStyling threw an error.\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nPlease review the changes carefully!\n```\n:::\n\n```{.r .cell-code}\nreadLines(\"bad_style.R\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"# Spacing\"                                        \n [2] \"average <- mean(feet / 12 + inches, na.rm = TRUE)\"\n [3] \"sqrt(x^2 + y^2)\"                                  \n [4] \"x <- 1:10\"                                        \n [5] \"base::get\"                                        \n [6] \"# Indenting\"                                      \n [7] \"if (y < 0 && debug) {\"                            \n [8] \"  message(\\\"Y is negative\\\")\"                     \n [9] \"}\"                                                \n[10] \"# Assignment\"                                     \n[11] \"x <- 5\"                                           \n```\n:::\n:::\n\n\n## What I think...\n\n1.  It runs (on your computer)\n\n2.  It runs (on my computer - without me having to do anything/much)\n\n3.  It does what you expect it to do (even after 5 years)\n\n4.  It is documented in some way\n\n## What Jenny Bryan thinks\n\nIf the first line of your R script is\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsetwd(\"C:\\Users\\jenny\\path\\that\\only\\I\\have\")\n```\n:::\n\n\nI will come into your office and SET YOUR COMPUTER ON FIRE ðŸ”¥.\n\n## \n\nIf the first line of your R script is\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(list = ls())\n```\n:::\n\n\nI will come into your office and SET YOUR COMPUTER ON FIRE ðŸ”¥.\n\n![](https://media.giphy.com/media/g79am6uuZJKSc/giphy.gif?cid=790b76117sut7t8n9aqyqdvi85oxyy4b0y3uai34xc6uq2u0&ep=v1_gifs_search&rid=giphy.gif&ct=g)\n",
    "supporting": [
      "dataHandling_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}